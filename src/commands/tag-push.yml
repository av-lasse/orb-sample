description: tag docker images and push to ecr-registry
parameters:
  ecr-registry:
    type: string
    default: '534003348933.dkr.ecr.eu-west-1.amazonaws.com'
  service:
    type: string
    default: ''
  pull-tag:
    type: string
    default: ''
  push-tags:
    type: string
    default: 'latest,main,"$(date "+%d-%m-%Y")"' # Default push tags

steps:
  - run:
      name: Pull the images for tagging
      command: |
        docker pull ${ecr-registry}/${service}:${pull-tag}
  - run:
      name: Tag image
      command: |
        IFS=',' read -ra push_tags <<< "${push-tags}"
        for tag in "${push_tags[@]}"; do
          docker tag ${ecr-registry}/${service}:${tags} ${ecr-registry}/${service}:${push-tag}
        done
  - run:
      name: Push image
      command: |
        IFS=',' read -ra push_tags <<< "${push-tags}"
        for tag in "${push_tags[@]}"; do
          docker push ${ecr-registry}/${service}:${tag}
        done
