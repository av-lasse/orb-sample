description: Tag Docker images and push to ECR registry
parameters:
  ecr-registry:
    type: string
    default: '534003348933.dkr.ecr.eu-west-1.amazonaws.com'
  service:
    type: string
    default: ''
  pull-tag:
    type: string
    default: ''
  push-tags:
    type: string
    default: 'latest,main,"$(date "+%d-%m-%Y")"' # Default push tags

steps:
  - run:
      name: Set Environment Variables
      command: |
        export ECR_REGISTRY="${ecr-registry}"
        export SERVICE="${service}"
        export PULL_TAG="${pull-tag}"
        export PUSH_TAGS="${push-tags}"
  - run:
      name: Pull image for tagging
      command: |
        docker pull "${ecr-registry}/${service}:${pull-tag}"
  - run:
      name: Tag image and push tags
      command: << include(scripts/tag-and-push.sh) >>
